<section class="row">
    <ul class="nav nav-tabs" id="profile-nav">
    {{#currentUser.is_runner}}
        <li class="active"><a href="#profile" data-toggle="tab">Profile</a></li>
        <li><a href="#admin" data-toggle="tab">Admin</a></li>
        {{#profileUser.getIs_runner}}
            <li><a href="#runner" data-toggle="tab">Designer</a></li>
        {{/profileUser.getIs_runner}}
        <li><a href="#mynotes" data-toggle="tab">My notes</a></li>
        <li><a href="#budgethistory" data-toggle="tab">Budget History</a></li>
    {{/currentUser.is_runner}}
    {{^currentUser.is_runner}}
        <li class="active"><a href="#profile" data-toggle="tab">User Info</a></li>
        {{#profileUser.getIs_runner}}
            <li><a href="#runner" data-toggle="tab">Designer</a></li>
        {{/profileUser.getIs_runner}}
        {{#reqUserId}}
            <li><a href="#mynotes" data-toggle="tab">My notes</a></li>
        {{/reqUserId}}
        <li>
            <a href="#budgethistory" data-toggle="tab">Budget History</a>
        </li>

    {{/currentUser.is_runner}}
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="profile">
            <div class="col-md-6">
                <div class="common-info">
                    <div id="user-avatar">
                        <img id="avatar" src="{{& userAvatarUrl}}" title="{{profileUser.getNickname}}'s picture" />
                        <div class="userName" id="userName">{{profileUser.getNickname}}</div>
                        <div class="profileInfoFavorite" id="profileInfoFavorite">
                            <div class="{{favoriteClass}}" title="{{favoriteTitle}}">&nbsp;</div>
                            <span class="profileFavoriteText" data-favorite-count="{{favorite_count}}"></span>
                        </div>        
                        {{& profileInfoFavorite}}
                    </div>
                    <div class="row" id="globalinfo">
                        <div class="col-md-6">
                            <p class="info-label" id="user-location">
                                Location:<br />
                                {{#profileUser.getCity}}
                                    <a class="userInfoLink" href="{{& gMapSearch}}{{profileUser.getCity}}{{countryName}}&z=6" target="_blank" 
                                      title="See location on Google Maps">{{profileUser.getCity}}</a>
                                {{/profileUser.getCity}}
                                {{#countryCodeUrl}}
                                    <a class="userInfoLink" href="{{& ciaGovBase}}{{countryCodeUrl}}.html" target="_blank" 
                                      title="{{countryName}}">{{profileUser.getCountry}}</a>
                                {{/countryCodeUrl}}
                            </p>
                            <p class="info-label" id="info-currenttime" title="{{timezone}}">
                                Local Time:<br />
                                <span>{{localTime}}</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="info-label title-label-small" id="user-age">Worklist age:<br />
                                <span id="info-joined">{{joined}}</span>
                            </p>
                            <p class="totals">
                                <span>Total jobs:</span>
                                {{#userStats.getTotalJobsCount}}
                                    <a href="#" id="total-jobs">{{userStats.getTotalJobsCount}}</a>
                                {{/userStats.getTotalJobsCount}}
                                {{^userStats.getTotalJobsCount}}
                                    0
                                {{/userStats.getTotalJobsCount}}
                            </p>
                            <p class="totals"><span>Total earned:</span> ${{totalEarnings}}</p>
                            <p class="totals"><span>Last 30 days:</span> ${{latestEarnings}}</p>
                        </div>
                    </div>
                </div>
                <p class="info-label title-label-medium">Strengths<br />
                    <span id="info-skills">{{profileUser.getSkills}}</span>
                </p>

                <div class='reviewTitle title-label-big'>
                    Reviews
                    {{^ownProfile}}
                        <div class='reviewAddLink'>
                            <a href='javascript:;'>Add your review</a>
                        </div>
                        <div class='reviewEditLink'>
                            <a href='javascript:;'>Edit your review</a>
                        </div>
                        {{/ownProfile}}
                </div>
                <div class='reviewsList'>
                    {{& reviewsList}}
                </div>
                <p class="info-label about title-label-big">
                    About
                </p>
                <span id="info-about">{{profileUser.getAbout}}</span>
            </div><!-- end of left-column -->
            <div class="col-md-6">
                <div class="button-row">
                    {{#reqUserId}} 
                    <span id="info-budget">
                        <input type="submit" {{#disableGiveBudget}}disabled="disabled" class="button-disabled disableable"{{/disableGiveBudget}}
                          title="Remaining budget you can give: ${{reqUser.getBudget}}" id="give" value="Give Budget" />
                    </span>
                    <span id="btn-bonus">
                        <input type="submit" {{#disablePayBonus}}disabled="disabled" class="button-disabled disableable"{{/disablePayBonus}}
                          title="Remaining budget you can give: ${{reqUser.getBudget}}" id="pay_bonus" value="Pay Bonus" name="pay_bonus" />
                    </span>
                    {{/reqUserId}} 
                </div>

                <p class = "profileContactFavorite">Contact info:
                    <span id="info-contactway">{{profileUser.getContactway}}</span>
                </p>

                {{#reqUserId}}{{^ownProfile}}
                <p class = "info-label title-label-medium">
                    Send Message <span>(user will be sent message via email)</span>
                    <div id="profile-pingtask" title="Ping about task" class="popup-body">
                        <form name="popup-form" action="" method="post">
                            <input type="hidden" name="itemid" value="0" />
                            <input type="hidden" name="bidder" value="0" />
                            <textarea id="ping-msg" name="ping-msg"></textarea>
                            <p>
                                <input type="checkbox" id="copy-me" name="copy_me" checked="checked" />
                                <label for="copy-me">Copy me in email</label>
                                <input type="checkbox" id="echo-journal" name="echo_journal" checked="checked"/>
                                <label for="echo-journal">Echo to public chat</label>
                            </p>
                            <input type="submit" id="send-ping-btn" value="Send Message" />
                        </form>
                    </div>
                </p>
                {{/ownProfile}}{{/reqUserId}} 

                <p class = "info-label title-label-medium jobs">Active jobs</p>

                <div id="jobs-table">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job ID & Summary</th>
                                <th class="status">Status</th>
                                <th class="sandbox">Sandbox</th>
                                <th class="unfollow">Un-Follow</th>
                            </tr>
                        </thead>
                        <tbody><tr><td></td></tr>
                        </tbody>
                    </table>
                </div>

                <p class = "info-label title-label-medium completed-jobs">Last 5 completed jobs</p>
                <div id="completed-jobs-table">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job ID & Summary</th>
                                <th class="cost">Cost</th>
                                <th class="time">Time</th>
                            </tr>
                        </thead>
                        <tbody><tr><td></td></tr>
                        </tbody>
                    </table>
                </div>
            </div><!-- end of right-column -->
        </div>
        <div class="tab-pane" id="admin">
            <div class="row">
                <div class="col-md-6">
                    <h3>Email</h3>
                    <p id="info-email"><a href="mailto:{{profileUser.getUsername}}">{{profileUser.getUsername}}</a></p>
                    <form id="roles" method="post" action="">
                        <h3>Roles</h3>
                        <p>
                            <input type="checkbox" name="isrunner" value="isrunner" id="isrunner" {{#profileUser.isRunner}}checked="checked"{{/profileUser.isRunner}} /><label for="isrunner" class="info-label">Designer</label>
                            <input type="checkbox" name="ispayer" value="ispayer" id="ispayer" {{#profileUser.isPayer}}checked="checked"{{/profileUser.isPayer}} /><label for="ispayer" class="info-label">Payer</label>
                        </p>
                        <h3>Payment Information</h3>
                        <p>
                            <label for="isw9approved" class="info-label">W9</label>
                            <select id="w9status" name="w9status" {{^profileUser.isUsCitizen}}disabled="disabled"{{/profileUser.isUsCitizen}}>
                                <option value="awaiting-receipt" {{#w9statusAwaitingReceipt}}selected="selected"{{/w9statusAwaitingReceipt}}>Awaiting Receipt</option>
                                <option value="pending-approval" {{#w9statusPendingApproval}}selected="selected"{{/w9statusPendingApproval}}>Pending Approval</option>
                                <option value="approved" {{#w9statusApproved}}selected="selected"{{/w9statusApproved}}>Approved</option>
                                <option value="rejected" {{#w9statusRejected}}selected="selected"{{/w9statusRejected}}>Rejected</option>
                                <option value="not-applicable" {{#w9statusNotApplicable}}selected="selected"{{/w9statusNotApplicable}}>Not Applicable</option>
                            </select>
                            <input type="checkbox" id="isw2employee" 
                              name="isw2employee" {{#profileUser.getHas_W2}}checked="checked"{{/profileUser.getHas_W2}} />
                            <label for="isw2employee" class="info-label">W2 Employee</label>
                            <input type="checkbox" id="ispaypalverified" 
                              name="ispaypalverified" {{#profileUser.getPaypal_verified}}checked="checked"{{/profileUser.getPaypal_verified}}/>
                            <label for="ispaypalverified" class="info-label">PayPal Verified</label>
                        </p>
                        <h3>Preferred Payment Method</h3>
                        <p>
                            <span id="info-payway">{{profileUser.getPayway}}</span>
                        </p>
                        <h3>PayPal E-Mail</h3>
                        <p>
                            <span id="info-paypal">{{profileUser.getPaypal_email}}</span>
                        </p>
                        <input type="hidden" name="userid" id="userid" value="{{profileUser.getId}}" />
                    </form>
                </div>
                <div class="col-md-6">
                    <form method="post" action="" name="userDropdownOptions" id="userDropdownOptions">
                        {{#currentUser.is_payer}}
                        <h3>Annual Salary</h3>
                        <p>
                            <input type="text" id="annual_salary" name="annual_salary" value="{{Annual_Salary}}" />
                            <input class="admin-submit" type="button" id="save_salary" value="Save salary"  name="save_salary"/>
                        </p>
                        {{/currentUser.is_payer}}
                        <h3>Manager</h3>
                        <p>
                            {{& managerUserSelectbox}}
                        </p>
                        <h3>Referred By</h3>
                        <p>
                            {{& referrerUserSelectbox}}
                        </p>
                        <h3>Status</h3>
                        <select id="isactive" name="isactive" style="width: auto;">
                            <option value="0" {{#userIsInactive}}selected="selected"{{/userIsInactive}}>inactive</option>
                            <option value="1" {{#userIsActive}}selected="selected"{{/userIsActive}}>active</option>
                            <option value="2" {{#userIsSecured}}selected="selected"{{/userIsSecured}}>secured</option>
                        </select>
                        <h3>Found Us On:</h3>
                        <p>
                            <span>{{profileUser.getFindus}}</span>
                        </p>
                    </form>
                        <p class = "info-label title-label-small">User last seen: <br />
                        <span>{{lastSeen}}</span>
                        </p>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="runner">
            <div class="row">
                <div class="col-md-6">
                    <div class="runnerStatistics">
                        <div id="stats-panel">
                            <h3>Jobs as Designer</h3>
                            <table class="table table-striped table-runner-stats">
                                <thead>
                                    <tr class="table-hdng">
                                        <td>Total/Active Jobs</td>
                                        <td>Avg. Job Run Time</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="row-role-list-live">
                                        <td>
                                        {{#userStats.getRunnerTotalJobsCount}}
                                            <a href = "#" id = "runner-total-jobs">{{userStats.getRunnerTotalJobsCount}}</a>
                                        {{/userStats.getRunnerTotalJobsCount}}
                                        {{^userStats.getRunnerTotalJobsCount}}
                                            0
                                        {{/userStats.getRunnerTotalJobsCount}}
                                        {{#userStats.getRunnerActiveJobsCount}}
                                            <a href = "#" id = "runner-active-jobs">{{userStats.getRunnerActiveJobsCount}}</a>
                                        {{/userStats.getRunnerActiveJobsCount}}
                                        {{^userStats.getRunnerActiveJobsCount}}
                                            0
                                        {{/userStats.getRunnerActiveJobsCount}}
                                        </td>
                                        <td>{{userStats.getAvgJobRunTime}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>                
                </div>
                <div class="col-md-6">
                    <h3>Who has worked for Designer</h3>
                    <div class="runnerWorkers" >
                        <table class="table table-striped table-runner-workers" id="runner-workers">
                            <thead>
                                <tr class="table-hdng">
                                    <th>Username</th>
                                    <th># of Jobs</th>
                                    <th>Total Earned</th>
                                </tr>
                            </thead>
                            <tbody class="runnerWorkerContent">
                                {{& runnerWorkers}}
                            </tbody>
                        </table>
                    </div>
                    <h3>Projects worked on by Designer</h3>  
                    <div class="runnerProjects" >
                        <table class="table table-striped table-runner-projects" id="runner-projects">
                            <thead>
                                <tr class="table-hdng">
                                    <th>Project Name</th>
                                    <th># of Jobs</th>
                                    <th>Project Total</th>
                                </tr>
                            </thead>
                            <tbody class="runnerProjectContent">
                                {{& runnerProjects}}
                            </tbody>
                        </table>
                    </div>                                                          
                </div>
            </div>
        </div>
        <div class="tab-pane" id="mynotes">
        </div>
        <div class="tab-pane" id="budgethistory">
        </div>
    </div>
</section>
<script type="text/javascript">
    // This global variable user_id should not be used anymore, replace it by userInfo.user_id .
    // All the variables should be included in the object userInfo
    // To have a smooth migration, the variable is kept for the moment.
    var admin = {{#currentUser.is_payer}}true{{/currentUser.is_payer}}{{^currentUser.is_payer}}false{{/currentUser.is_payer}};
    var userInfo = {
        manager: {{manager}},
        referred_by: {{referred_by}},
        user_id: {{userId}},
        nickName: '{{profileUser.getNickName}}',
        tab: '{{tab}}'
    };
</script>

<!-- popup div's -->
<div id="budget-dialog" title="Budget details" data-userid = "{{profileUser.getId}}">
</div>

{{> budget/give-modal}}
{{> budget/update-modal}}
{{> budget/addfunds-modal}}

<div id="reject-w9" title="Reject W9">
    
    <form method="post" action = "">
        <label for="reject-reason" class="info-label">Reason: </label><br/>
        <textarea id="reject-reason" name="reason"></textarea><br/>
        <span style="float: right;"><span id="charCount">100</span> characters remaining</span>
        <input type="hidden" name="receiver_id" value="{{profileUser.getId}}" />
    </form>
</div><!-- end of reject w9 div -->
<div id="pay-bonus" title="Pay Bonus">
    <form method="post" action = "">
        <div class="leftBonusArea">
            <label for="bonus-amount" class="info-label">Amount: </label><br/>
            <input type="text" id="bonus-amount" name="amount" /><br/>
        </div>
        <div class="rightBonusArea">
            <label for="budget-source" class="info-label">Source: </label><br/>
            <select id="budget-source-combo-bonus" name="budget-source-combo-bonus" class="project-dropdown">
            <option value="0" selected="selected">Select a budget</option>
            {{& reqUser.getBudgetCombo}}
            </select>
            <span id="validationMessage"></span>
        </div>
        <div class="clearBonusArea">
        <label for="bonus-reason" class="info-label">Reason: </label><br/>
            <input type="text" id="bonus-reason" name="reason" style="width:95%" /><br/>
            <input type="hidden" id="bonus-receiver" name="receiver_id" value="{{profileUser.getId}}" />
        <input type="submit" value="Pay Bonus" />
    </form>

    <!-- Add the bonus history table -->
    {{#currentUser.is_runner}}
    <hr/>
    <table class="bonus-history table-bonus-history">
    <thead>
        <tr style="cursor:arrow;" class="table-hdng">
            <th width="95px">Date</th>
            <th width="50px">Amount</th>
            <th width="80px">Receiver</th>
            <th width="300px">Description</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    </table>
    {{/currentUser.is_runner}}

</div><!-- end of pay bonus div -->
